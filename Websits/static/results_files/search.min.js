/*! tineye 2016-07-25 */
function toggleDisclosureWidget(t){var e=document.getElementById(t);e.className="slide-show"==e.className?"slide-hide":"slide-show"}function gotopage(t){""!=t&&(self.location=t)}function overlay(t,e,i){close_open_overlay(),$("#overlay-"+e+i).children().remove();var s='<div class="toggle"><div id="your_image_label-'+e+'" class="nonactive yourimage"><h4><a class="toggle_images-'+e+'">Your image</a></h4></div>';s+='<div class="switch switch-active-right"><input name="search_button" value="Switch" class="button toggle_images-'+e+'" type="submit" /></div>',s+='<div id="matching_image_label-'+e+'" class="active-right imagematch"><h4><a class="toggle_images-'+e+'">Image match</a></h4></div></div>';var o='<div class="overlay-container"><div class="images overlay" id="overlay_image-'+e+'"><div id="matching_image-'+e+'" class="active"></div></div><div id="your_image-'+e+'" ></div></div>';$("#overlay-"+e+i).append(s).append(o);var n=new Image;$(n).bind("load",function(){var s=n.width,o=n.height,r=$(".overlay-container").width()-20;s>2*r&&(o=Math.round(2*r/s*o),s=2*r),$(document).bind("keydown",function(t){var o=t.which?t.which:t.keyCode;39==o||63235==o?show_match_image(e):37==o||63234==o?show_your_image(s,e):27==o&&close_overlay(e+i)}),toggle_box=$(".toggle_images-"+e),toggle_box.click(function(){$("#matching_image-"+e).hasClass("active")?show_your_image(s,e):show_match_image(e)});var a=$("#overlay_image-"+e);a.css("width",s/2+"px"),a.css("height",o+"px"),a.css("margin","10px auto 10px"),a.css("background-position","0px center"),a.css("background-size",s+"px "+o+"px"),a.css("background-image","url('"+t+"')")}),n.src=t,open_overlay=e+i,$(".results").off("click",close_open_overlay).on("click",close_open_overlay),$(".compare-popup").off("click",function(t){t.stopPropagation()}).on("click",function(t){t.stopPropagation()})}function close_open_overlay(){null!==open_overlay&&close_overlay(open_overlay)}function close_overlay(t){toggleDisclosureWidget("compare-"+t),$("#overlay-"+t).children().remove(),$(document).unbind("keydown"),open_overlay=null,$(".results").off("click",close_open_overlay),$(".compare-popup").off("click",function(t){t.stopPropagation()})}function show_your_image(t,e){$("#overlay_image-"+e).css("background-position",-(t/2)+"px center"),$("#your_image_label-"+e).removeClass("nonactive"),$("#matching_image_label-"+e).removeClass("active-right"),$("#your_image_label-"+e).addClass("active-left"),$("#matching_image_label-"+e).addClass("nonactive"),$("#matching_image-"+e).removeClass("active"),$("#your_image-"+e).addClass("active"),$(".switch").removeClass("switch-active-right"),$(".switch").addClass("switch-active-left")}function show_match_image(t){$("#overlay_image-"+t).css("background-position","0px center"),$("#your_image_label-"+t).removeClass("active-left"),$("#matching_image_label-"+t).removeClass("nonactive"),$("#your_image_label-"+t).addClass("nonactive"),$("#matching_image_label-"+t).addClass("active-right"),$("#your_image-"+t).removeClass("active"),$("#matching_image-"+t).addClass("active"),$(".switch").removeClass("switch-active-left"),$(".switch").addClass("switch-active-right")}function exit(t,e,i,s){if(document.images){var o=encodeURIComponent||escape;(new Image).src="/exit?type="+i+"&pos="+s+"&key="+e+"&url="+o(t.replace(/#.*/,"")).replace(/\+/g,"%2B")}return!0}function toggle_link_to_search(){$("#link_to_search_url").toggle(),$("#link_to_search").toggle()}function progress_handler(){display_throbber()}function display_throbber(){window.operamini||($("#url_box")[0].setAttribute("readonly","readonly"),$("#url_submit")[0].disabled=!0)}function hide_throbber(){$("#throbber").hide(),window.operamini||$("#url_box")[0].removeAttribute("readonly")}function handle_opera_mini(){return window.operamini?($("#upload-button").addClass("old-search"),$("#upload-button").text("Choose an image"),$("#upload-button").addClass("old-search"),$("#upload_box").addClass("old-search"),$("#file_submit").show(),$(".input-container").addClass("old-search"),$("#url_box").attr("placeholder","Or enter an image URL"),$(".forms").addClass("old-forms"),$(".forms a").hide(),$(".forms #browser").hide(),$(".ads").hide(),$("#google_ads_div_index_page_ad_wrapper").hide(),!0):!1}function drag_and_drop(t){if(!handle_opera_mini()){var e={url:t,formData:[{name:"json",value:"True"}],dataType:"json",done:function(t,e){e.result.error?alert(e.result.error):window.location=e.result.redirect_link},start:function(){$("#upload_overlay_message").show()},always:function(){$("body").removeClass("dragenter"),$("#upload_overlay_message").hide()},dropZone:$("#upload_overlay")};$("#upload_box_drag").fileupload(e),$("body").on("dragenter",function(t){t.originalEvent.stopPropagation(),t.originalEvent.preventDefault(),$("body").addClass("dragenter")}),$("#upload_overlay").on("dragover dragleave dragenter",function(t){t.stopPropagation(),t.preventDefault()}),$("#upload_overlay").on("drop",function(t){if(t.originalEvent.preventDefault(),!t.originalEvent.dataTransfer.files.length){var e=t.originalEvent.dataTransfer.getData("text/html");if(e){var i=e.match(/<img[^>]+src\s*=\s*[\"]([^\"]*)[\"][^>]*>/gi);return i?(i=RegExp.$1,i=i.replace("&amp;","%26"),$("#url_box_drag").val(i),$("#url_form_drag").submit(),$("#upload_overlay").show(),$("#upload_overlay_message").show()):e&&$("body").removeClass("dragenter"),void 0}return(e=t.originalEvent.dataTransfer.getData("text/plain"))?($("#url_box_drag").val(e),$("#url_form_drag").submit(),$("#upload_overlay").show(),$("#upload_overlay_message").show(),void 0):($("body").removeClass("dragenter"),void 0)}}),$("#upload_overlay").on("dragleave",function(t){t.originalEvent.stopPropagation(),t.originalEvent.preventDefault(),$("body").removeClass("dragenter")})}}function change_sort_filter(t,e,i){var s={};t&&(s.domain=t),e&&(s.sort=e),i&&(s.order=i),window.location.search="?"+$.param(s)}function get_collection_domains(t,e,i,s){$.ajax({url:"/search/get_collection_domains/"+t,dataType:"json"}).done(function(t){if($("#collections").empty(),t.domains.length){$.each(t.domains,function(t,o){var n=o[0],r=o[1],a=$("<li />"),l=$("<input />",{type:"radio",id:n+"-cb","class":"radio",value:n}).appendTo(a),h=$("<label />",{"for":n+"-cb","class":"radio",text:n+" ("+r+")",onclick:""}).appendTo(a);$("<span></span>").prependTo(h),n==e&&(l=l.prop("checked","checked"),h.addClass("active")),l.on("click",function(){var t=$(this).attr("id");$("input.radio").each(function(){$(this).attr("id")!=t&&$(this).prop("checked",!1)}),$(this).prop("checked")?change_sort_filter($(this).val(),i,s):change_sort_filter("",i,s)}),$("#collections").append(a)}),t.domains.length>1&&$("#collection-count").text("There are "+t.domains.length+" collections to filter on.");var o=$(".clear_collections");o.on("click",function(){change_sort_filter("",i,s)}),$(".filters").show(),""!==e&&$(".clear_collections").addClass("visible")}window.operamini||$(".ads").show()})}function handle_JSON_action_response(){}function plugin_download(t,e){$.post("/plugins",{plugin:t,version:e},handle_JSON_action_response,"json")}function get_browser(){var t=navigator.userAgent.toLowerCase();return/(iphone|ipad|ipod|android|blackberry|windows phone)/.test(t)?"":/opr/.test(t)?"opera":/crmo/.test(t)||/crios/.test(t)?"chrome":/chrome/.test(t)?"chrome":/safari/.test(t)?"safari":/msie/.test(t)||/trident/.test(t)?"msie":/mozilla/.test(t)?"mozilla":""}function show_plugins(){""===get_browser()&&($(".plugins-container div").hide(),$(".highlights .col-sm-4").prop("class","col-xs-12 col-sm-6")),$(".highlights").show()}function display_extension_link(){var t=get_browser();"mozilla"===t?($("#firefox").show(),$("#browser").html("for Firefox")):"chrome"===t?($("#chrome").show(),$("#browser").html("for Chrome")):"safari"===t?($("#safari").show(),$("#browser").html("for Safari")):"msie"===t?($("#msie").show(),$("#browser").html("for Internet Explorer")):"opera"===t?($("#opera").show(),$("#browser").html("for Opera")):$("#browser").hide()}function detect_browser_search_page(){var t=get_browser(),e="firefox";"mozilla"==t||""==t?$("#extension-name").html("the official TinEye extension for Firefox with right-click functionality"):"chrome"==t?($("#extension-name").html("the official TinEye extension for Chrome with right-click functionality"),e="chrome"):"msie"==t?($("#extension-name").html("the official TinEye extension for Internet Explorer with right-click functionality"),e="internet-explorer"):"safari"==t?($("#extension-name").html("the official TinEye extension for Safari with right-click functionality"),e="safari"):"opera"==t&&($("#extension-name").html("the official TinEye extension for Opera"),e="opera"),$(".plugin-alert").attr("class","plugin-alert "+e)}function detect_browser_plugin_page(){var t=get_browser();"chrome"==t?show_plugin("chrome"):"msie"==t?show_plugin("ie"):"safari"==t?show_plugin("safari"):"opera"==t?show_plugin("opera"):("mozilla"==t||""==t)&&show_plugin("firefox")}function show_plugin(t){$("#firefox-container").hide(),$("#chrome-container").hide(),$("#ie-container").hide(),$("#safari-container").hide(),$("#opera-container").hide(),$("#"+t+"-container").show()}function switch_plugin_icon(){var t=get_browser(),e="firefox";"chrome"==t?e="chrome":"msie"==t?e="internet-explorer":"safari"==t?e="safari":"opera"==t&&(e="opera"),$("#plugin-icon").attr("class",e)}function show_drag_and_drop(){var t=get_browser();("chrome"==t||"safari"==t||"mozilla"==t)&&$(".drag-and-drop").show()}var open_overlay=null;jQuery.preloadImages=function(){for(var t=0;arguments.length>t;t++)jQuery("<img>").attr("src",arguments[t])},$.preloadImages("/images/throbber.gif"),function(t){"function"==typeof define&&define.amd?define(["jquery"],t):t(jQuery)}(function(t,e){var i=0,s=Array.prototype.slice,o=t.cleanData;t.cleanData=function(e){for(var i,s=0;null!=(i=e[s]);s++)try{t(i).triggerHandler("remove")}catch(n){}o(e)},t.widget=function(i,s,o){var n,r,a,l,h={},c=i.split(".")[0];i=i.split(".")[1],n=c+"-"+i,o||(o=s,s=t.Widget),t.expr[":"][n.toLowerCase()]=function(e){return!!t.data(e,n)},t[c]=t[c]||{},r=t[c][i],a=t[c][i]=function(t,i){return this._createWidget?(arguments.length&&this._createWidget(t,i),e):new a(t,i)},t.extend(a,r,{version:o.version,_proto:t.extend({},o),_childConstructors:[]}),l=new s,l.options=t.widget.extend({},l.options),t.each(o,function(i,o){return t.isFunction(o)?(h[i]=function(){var t=function(){return s.prototype[i].apply(this,arguments)},e=function(t){return s.prototype[i].apply(this,t)};return function(){var i,s=this._super,n=this._superApply;return this._super=t,this._superApply=e,i=o.apply(this,arguments),this._super=s,this._superApply=n,i}}(),e):(h[i]=o,e)}),a.prototype=t.widget.extend(l,{widgetEventPrefix:r?l.widgetEventPrefix||i:i},h,{constructor:a,namespace:c,widgetName:i,widgetFullName:n}),r?(t.each(r._childConstructors,function(e,i){var s=i.prototype;t.widget(s.namespace+"."+s.widgetName,a,i._proto)}),delete r._childConstructors):s._childConstructors.push(a),t.widget.bridge(i,a)},t.widget.extend=function(i){for(var o,n,r=s.call(arguments,1),a=0,l=r.length;l>a;a++)for(o in r[a])n=r[a][o],r[a].hasOwnProperty(o)&&n!==e&&(i[o]=t.isPlainObject(n)?t.isPlainObject(i[o])?t.widget.extend({},i[o],n):t.widget.extend({},n):n);return i},t.widget.bridge=function(i,o){var n=o.prototype.widgetFullName||i;t.fn[i]=function(r){var a="string"==typeof r,l=s.call(arguments,1),h=this;return r=!a&&l.length?t.widget.extend.apply(null,[r].concat(l)):r,a?this.each(function(){var s,o=t.data(this,n);return o?t.isFunction(o[r])&&"_"!==r.charAt(0)?(s=o[r].apply(o,l),s!==o&&s!==e?(h=s&&s.jquery?h.pushStack(s.get()):s,!1):e):t.error("no such method '"+r+"' for "+i+" widget instance"):t.error("cannot call methods on "+i+" prior to initialization; "+"attempted to call method '"+r+"'")}):this.each(function(){var e=t.data(this,n);e?e.option(r||{})._init():t.data(this,n,new o(r,this))}),h}},t.Widget=function(){},t.Widget._childConstructors=[],t.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:!1,create:null},_createWidget:function(e,s){s=t(s||this.defaultElement||this)[0],this.element=t(s),this.uuid=i++,this.eventNamespace="."+this.widgetName+this.uuid,this.options=t.widget.extend({},this.options,this._getCreateOptions(),e),this.bindings=t(),this.hoverable=t(),this.focusable=t(),s!==this&&(t.data(s,this.widgetFullName,this),this._on(!0,this.element,{remove:function(t){t.target===s&&this.destroy()}}),this.document=t(s.style?s.ownerDocument:s.document||s),this.window=t(this.document[0].defaultView||this.document[0].parentWindow)),this._create(),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:t.noop,_getCreateEventData:t.noop,_create:t.noop,_init:t.noop,destroy:function(){this._destroy(),this.element.unbind(this.eventNamespace).removeData(this.widgetName).removeData(this.widgetFullName).removeData(t.camelCase(this.widgetFullName)),this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled "+"ui-state-disabled"),this.bindings.unbind(this.eventNamespace),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")},_destroy:t.noop,widget:function(){return this.element},option:function(i,s){var o,n,r,a=i;if(0===arguments.length)return t.widget.extend({},this.options);if("string"==typeof i)if(a={},o=i.split("."),i=o.shift(),o.length){for(n=a[i]=t.widget.extend({},this.options[i]),r=0;o.length-1>r;r++)n[o[r]]=n[o[r]]||{},n=n[o[r]];if(i=o.pop(),1===arguments.length)return n[i]===e?null:n[i];n[i]=s}else{if(1===arguments.length)return this.options[i]===e?null:this.options[i];a[i]=s}return this._setOptions(a),this},_setOptions:function(t){var e;for(e in t)this._setOption(e,t[e]);return this},_setOption:function(t,e){return this.options[t]=e,"disabled"===t&&(this.widget().toggleClass(this.widgetFullName+"-disabled ui-state-disabled",!!e).attr("aria-disabled",e),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")),this},enable:function(){return this._setOption("disabled",!1)},disable:function(){return this._setOption("disabled",!0)},_on:function(i,s,o){var n,r=this;"boolean"!=typeof i&&(o=s,s=i,i=!1),o?(s=n=t(s),this.bindings=this.bindings.add(s)):(o=s,s=this.element,n=this.widget()),t.each(o,function(o,a){function l(){return i||r.options.disabled!==!0&&!t(this).hasClass("ui-state-disabled")?("string"==typeof a?r[a]:a).apply(r,arguments):e}"string"!=typeof a&&(l.guid=a.guid=a.guid||l.guid||t.guid++);var h=o.match(/^(\w+)\s*(.*)$/),c=h[1]+r.eventNamespace,p=h[2];p?n.delegate(p,c,l):s.bind(c,l)})},_off:function(t,e){e=(e||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,t.unbind(e).undelegate(e)},_delay:function(t,e){function i(){return("string"==typeof t?s[t]:t).apply(s,arguments)}var s=this;return setTimeout(i,e||0)},_hoverable:function(e){this.hoverable=this.hoverable.add(e),this._on(e,{mouseenter:function(e){t(e.currentTarget).addClass("ui-state-hover")},mouseleave:function(e){t(e.currentTarget).removeClass("ui-state-hover")}})},_focusable:function(e){this.focusable=this.focusable.add(e),this._on(e,{focusin:function(e){t(e.currentTarget).addClass("ui-state-focus")},focusout:function(e){t(e.currentTarget).removeClass("ui-state-focus")}})},_trigger:function(e,i,s){var o,n,r=this.options[e];if(s=s||{},i=t.Event(i),i.type=(e===this.widgetEventPrefix?e:this.widgetEventPrefix+e).toLowerCase(),i.target=this.element[0],n=i.originalEvent)for(o in n)o in i||(i[o]=n[o]);return this.element.trigger(i,s),!(t.isFunction(r)&&r.apply(this.element[0],[i].concat(s))===!1||i.isDefaultPrevented())}},t.each({show:"fadeIn",hide:"fadeOut"},function(e,i){t.Widget.prototype["_"+e]=function(s,o,n){"string"==typeof o&&(o={effect:o});var r,a=o?o===!0||"number"==typeof o?i:o.effect||i:e;o=o||{},"number"==typeof o&&(o={duration:o}),r=!t.isEmptyObject(o),o.complete=n,o.delay&&s.delay(o.delay),r&&t.effects&&t.effects.effect[a]?s[e](o):a!==e&&s[a]?s[a](o.duration,o.easing,n):s.queue(function(i){t(this)[e](),n&&n.call(s[0]),i()})}})}),function(t){"use strict";"function"==typeof define&&define.amd?define(["jquery"],t):t(window.jQuery)}(function(t){"use strict";var e=0;t.ajaxTransport("iframe",function(i){if(i.async){var s,o,n,r=i.initialIframeSrc||"javascript:false;";return{send:function(a,l){s=t('<form style="display:none;"></form>'),s.attr("accept-charset",i.formAcceptCharset),n=/\?/.test(i.url)?"&":"?","DELETE"===i.type?(i.url=i.url+n+"_method=DELETE",i.type="POST"):"PUT"===i.type?(i.url=i.url+n+"_method=PUT",i.type="POST"):"PATCH"===i.type&&(i.url=i.url+n+"_method=PATCH",i.type="POST"),e+=1,o=t('<iframe src="'+r+'" name="iframe-transport-'+e+'"></iframe>').bind("load",function(){var e,n=t.isArray(i.paramName)?i.paramName:[i.paramName];o.unbind("load").bind("load",function(){var e;try{if(e=o.contents(),!e.length||!e[0].firstChild)throw Error()}catch(i){e=void 0}l(200,"success",{iframe:e}),t('<iframe src="'+r+'"></iframe>').appendTo(s),window.setTimeout(function(){s.remove()},0)}),s.prop("target",o.prop("name")).prop("action",i.url).prop("method",i.type),i.formData&&t.each(i.formData,function(e,i){t('<input type="hidden"/>').prop("name",i.name).val(i.value).appendTo(s)}),i.fileInput&&i.fileInput.length&&"POST"===i.type&&(e=i.fileInput.clone(),i.fileInput.after(function(t){return e[t]}),i.paramName&&i.fileInput.each(function(e){t(this).prop("name",n[e]||i.paramName)}),s.append(i.fileInput).prop("enctype","multipart/form-data").prop("encoding","multipart/form-data"),i.fileInput.removeAttr("form")),s.submit(),e&&e.length&&i.fileInput.each(function(i,s){var o=t(e[i]);t(s).prop("name",o.prop("name")).attr("form",o.attr("form")),o.replaceWith(s)})}),s.append(o).appendTo(document.body)},abort:function(){o&&o.unbind("load").prop("src",r),s&&s.remove()}}}}),t.ajaxSetup({converters:{"iframe text":function(e){return e&&t(e[0].body).text()},"iframe json":function(e){return e&&t.parseJSON(t(e[0].body).text())},"iframe html":function(e){return e&&t(e[0].body).html()},"iframe xml":function(e){var i=e&&e[0];return i&&t.isXMLDoc(i)?i:t.parseXML(i.XMLDocument&&i.XMLDocument.xml||t(i.body).html())},"iframe script":function(e){return e&&t.globalEval(t(e[0].body).text())}}})}),function(t){"use strict";"function"==typeof define&&define.amd?define(["jquery","jquery.ui.widget"],t):t(window.jQuery)}(function(t){"use strict";t.support.fileInput=!(RegExp("(Android (1\\.[0156]|2\\.[01]))|(Windows Phone (OS 7|8\\.0))|(XBLWP)|(ZuneWP)|(WPDesktop)|(w(eb)?OSBrowser)|(webOS)|(Kindle/(1\\.0|2\\.[05]|3\\.0))").test(window.navigator.userAgent)||t('<input type="file">').prop("disabled")),t.support.xhrFileUpload=!(!window.ProgressEvent||!window.FileReader),t.support.xhrFormDataFileUpload=!!window.FormData,t.support.blobSlice=window.Blob&&(Blob.prototype.slice||Blob.prototype.webkitSlice||Blob.prototype.mozSlice),t.widget("blueimp.fileupload",{options:{dropZone:t(document),pasteZone:t(document),fileInput:void 0,replaceFileInput:!0,paramName:void 0,singleFileUploads:!0,limitMultiFileUploads:void 0,limitMultiFileUploadSize:void 0,limitMultiFileUploadSizeOverhead:512,sequentialUploads:!1,limitConcurrentUploads:void 0,forceIframeTransport:!1,redirect:void 0,redirectParamName:void 0,postMessage:void 0,multipart:!0,maxChunkSize:void 0,uploadedBytes:void 0,recalculateProgress:!0,progressInterval:100,bitrateInterval:500,autoUpload:!0,messages:{uploadedBytes:"Uploaded bytes exceed file size"},i18n:function(e,i){return e=this.messages[e]||""+e,i&&t.each(i,function(t,i){e=e.replace("{"+t+"}",i)}),e},formData:function(t){return t.serializeArray()},add:function(e,i){return e.isDefaultPrevented()?!1:((i.autoUpload||i.autoUpload!==!1&&t(this).fileupload("option","autoUpload"))&&i.process().done(function(){i.submit()}),void 0)},processData:!1,contentType:!1,cache:!1},_specialOptions:["fileInput","dropZone","pasteZone","multipart","forceIframeTransport"],_blobSlice:t.support.blobSlice&&function(){var t=this.slice||this.webkitSlice||this.mozSlice;return t.apply(this,arguments)},_BitrateTimer:function(){this.timestamp=Date.now?Date.now():(new Date).getTime(),this.loaded=0,this.bitrate=0,this.getBitrate=function(t,e,i){var s=t-this.timestamp;return(!this.bitrate||!i||s>i)&&(this.bitrate=8*(e-this.loaded)*(1e3/s),this.loaded=e,this.timestamp=t),this.bitrate}},_isXHRUpload:function(e){return!e.forceIframeTransport&&(!e.multipart&&t.support.xhrFileUpload||t.support.xhrFormDataFileUpload)},_getFormData:function(e){var i;return"function"===t.type(e.formData)?e.formData(e.form):t.isArray(e.formData)?e.formData:"object"===t.type(e.formData)?(i=[],t.each(e.formData,function(t,e){i.push({name:t,value:e})}),i):[]},_getTotal:function(e){var i=0;return t.each(e,function(t,e){i+=e.size||1}),i},_initProgressObject:function(e){var i={loaded:0,total:0,bitrate:0};e._progress?t.extend(e._progress,i):e._progress=i},_initResponseObject:function(t){var e;if(t._response)for(e in t._response)t._response.hasOwnProperty(e)&&delete t._response[e];else t._response={}},_onProgress:function(e,i){if(e.lengthComputable){var s,o=Date.now?Date.now():(new Date).getTime();if(i._time&&i.progressInterval&&o-i._time<i.progressInterval&&e.loaded!==e.total)return;i._time=o,s=Math.floor(e.loaded/e.total*(i.chunkSize||i._progress.total))+(i.uploadedBytes||0),this._progress.loaded+=s-i._progress.loaded,this._progress.bitrate=this._bitrateTimer.getBitrate(o,this._progress.loaded,i.bitrateInterval),i._progress.loaded=i.loaded=s,i._progress.bitrate=i.bitrate=i._bitrateTimer.getBitrate(o,s,i.bitrateInterval),this._trigger("progress",t.Event("progress",{delegatedEvent:e}),i),this._trigger("progressall",t.Event("progressall",{delegatedEvent:e}),this._progress)}},_initProgressListener:function(e){var i=this,s=e.xhr?e.xhr():t.ajaxSettings.xhr();s.upload&&(t(s.upload).bind("progress",function(t){var s=t.originalEvent;t.lengthComputable=s.lengthComputable,t.loaded=s.loaded,t.total=s.total,i._onProgress(t,e)}),e.xhr=function(){return s})},_isInstanceOf:function(t,e){return Object.prototype.toString.call(e)==="[object "+t+"]"},_initXHRData:function(e){var i,s=this,o=e.files[0],n=e.multipart||!t.support.xhrFileUpload,r="array"===t.type(e.paramName)?e.paramName[0]:e.paramName;e.headers=t.extend({},e.headers),e.contentRange&&(e.headers["Content-Range"]=e.contentRange),n&&!e.blob&&this._isInstanceOf("File",o)||(e.headers["Content-Disposition"]='attachment; filename="'+encodeURI(o.name)+'"'),n?t.support.xhrFormDataFileUpload&&(e.postMessage?(i=this._getFormData(e),e.blob?i.push({name:r,value:e.blob}):t.each(e.files,function(s,o){i.push({name:"array"===t.type(e.paramName)&&e.paramName[s]||r,value:o})})):(s._isInstanceOf("FormData",e.formData)?i=e.formData:(i=new FormData,t.each(this._getFormData(e),function(t,e){i.append(e.name,e.value)})),e.blob?i.append(r,e.blob,o.name):t.each(e.files,function(o,n){(s._isInstanceOf("File",n)||s._isInstanceOf("Blob",n))&&i.append("array"===t.type(e.paramName)&&e.paramName[o]||r,n,n.uploadName||n.name)})),e.data=i):(e.contentType=o.type||"application/octet-stream",e.data=e.blob||o),e.blob=null},_initIframeSettings:function(e){var i=t("<a></a>").prop("href",e.url).prop("host");e.dataType="iframe "+(e.dataType||""),e.formData=this._getFormData(e),e.redirect&&i&&i!==location.host&&e.formData.push({name:e.redirectParamName||"redirect",value:e.redirect})},_initDataSettings:function(t){this._isXHRUpload(t)?(this._chunkedUpload(t,!0)||(t.data||this._initXHRData(t),this._initProgressListener(t)),t.postMessage&&(t.dataType="postmessage "+(t.dataType||""))):this._initIframeSettings(t)},_getParamName:function(e){var i=t(e.fileInput),s=e.paramName;return s?t.isArray(s)||(s=[s]):(s=[],i.each(function(){for(var e=t(this),i=e.prop("name")||"files[]",o=(e.prop("files")||[1]).length;o;)s.push(i),o-=1}),s.length||(s=[i.prop("name")||"files[]"])),s},_initFormSettings:function(e){e.form&&e.form.length||(e.form=t(e.fileInput.prop("form")),e.form.length||(e.form=t(this.options.fileInput.prop("form")))),e.paramName=this._getParamName(e),e.url||(e.url=e.form.prop("action")||location.href),e.type=(e.type||"string"===t.type(e.form.prop("method"))&&e.form.prop("method")||"").toUpperCase(),"POST"!==e.type&&"PUT"!==e.type&&"PATCH"!==e.type&&(e.type="POST"),e.formAcceptCharset||(e.formAcceptCharset=e.form.attr("accept-charset"))},_getAJAXSettings:function(e){var i=t.extend({},this.options,e);return this._initFormSettings(i),this._initDataSettings(i),i},_getDeferredState:function(t){return t.state?t.state():t.isResolved()?"resolved":t.isRejected()?"rejected":"pending"},_enhancePromise:function(t){return t.success=t.done,t.error=t.fail,t.complete=t.always,t},_getXHRPromise:function(e,i,s){var o=t.Deferred(),n=o.promise();return i=i||this.options.context||n,e===!0?o.resolveWith(i,s):e===!1&&o.rejectWith(i,s),n.abort=o.promise,this._enhancePromise(n)},_addConvenienceMethods:function(e,i){var s=this,o=function(e){return t.Deferred().resolveWith(s,e).promise()};i.process=function(e,n){return(e||n)&&(i._processQueue=this._processQueue=(this._processQueue||o([this])).pipe(function(){return i.errorThrown?t.Deferred().rejectWith(s,[i]).promise():o(arguments)}).pipe(e,n)),this._processQueue||o([this])},i.submit=function(){return"pending"!==this.state()&&(i.jqXHR=this.jqXHR=s._trigger("submit",t.Event("submit",{delegatedEvent:e}),this)!==!1&&s._onSend(e,this)),this.jqXHR||s._getXHRPromise()},i.abort=function(){return this.jqXHR?this.jqXHR.abort():(this.errorThrown="abort",s._trigger("fail",null,this),s._getXHRPromise(!1))},i.state=function(){return this.jqXHR?s._getDeferredState(this.jqXHR):this._processQueue?s._getDeferredState(this._processQueue):void 0},i.processing=function(){return!this.jqXHR&&this._processQueue&&"pending"===s._getDeferredState(this._processQueue)},i.progress=function(){return this._progress},i.response=function(){return this._response}},_getUploadedBytes:function(t){var e=t.getResponseHeader("Range"),i=e&&e.split("-"),s=i&&i.length>1&&parseInt(i[1],10);return s&&s+1},_chunkedUpload:function(e,i){e.uploadedBytes=e.uploadedBytes||0;var s,o,n=this,r=e.files[0],a=r.size,l=e.uploadedBytes,h=e.maxChunkSize||a,c=this._blobSlice,p=t.Deferred(),u=p.promise();return this._isXHRUpload(e)&&c&&(l||a>h)&&!e.data?i?!0:l>=a?(r.error=e.i18n("uploadedBytes"),this._getXHRPromise(!1,e.context,[null,"error",r.error])):(o=function(){var i=t.extend({},e),u=i._progress.loaded;i.blob=c.call(r,l,l+h,r.type),i.chunkSize=i.blob.size,i.contentRange="bytes "+l+"-"+(l+i.chunkSize-1)+"/"+a,n._initXHRData(i),n._initProgressListener(i),s=(n._trigger("chunksend",null,i)!==!1&&t.ajax(i)||n._getXHRPromise(!1,i.context)).done(function(s,r,h){l=n._getUploadedBytes(h)||l+i.chunkSize,u+i.chunkSize-i._progress.loaded&&n._onProgress(t.Event("progress",{lengthComputable:!0,loaded:l-i.uploadedBytes,total:l-i.uploadedBytes}),i),e.uploadedBytes=i.uploadedBytes=l,i.result=s,i.textStatus=r,i.jqXHR=h,n._trigger("chunkdone",null,i),n._trigger("chunkalways",null,i),a>l?o():p.resolveWith(i.context,[s,r,h])}).fail(function(t,e,s){i.jqXHR=t,i.textStatus=e,i.errorThrown=s,n._trigger("chunkfail",null,i),n._trigger("chunkalways",null,i),p.rejectWith(i.context,[t,e,s])})},this._enhancePromise(u),u.abort=function(){return s.abort()},o(),u):!1},_beforeSend:function(t,e){0===this._active&&(this._trigger("start"),this._bitrateTimer=new this._BitrateTimer,this._progress.loaded=this._progress.total=0,this._progress.bitrate=0),this._initResponseObject(e),this._initProgressObject(e),e._progress.loaded=e.loaded=e.uploadedBytes||0,e._progress.total=e.total=this._getTotal(e.files)||1,e._progress.bitrate=e.bitrate=0,this._active+=1,this._progress.loaded+=e.loaded,this._progress.total+=e.total},_onDone:function(e,i,s,o){var n=o._progress.total,r=o._response;n>o._progress.loaded&&this._onProgress(t.Event("progress",{lengthComputable:!0,loaded:n,total:n}),o),r.result=o.result=e,r.textStatus=o.textStatus=i,r.jqXHR=o.jqXHR=s,this._trigger("done",null,o)},_onFail:function(t,e,i,s){var o=s._response;s.recalculateProgress&&(this._progress.loaded-=s._progress.loaded,this._progress.total-=s._progress.total),o.jqXHR=s.jqXHR=t,o.textStatus=s.textStatus=e,o.errorThrown=s.errorThrown=i,this._trigger("fail",null,s)},_onAlways:function(t,e,i,s){this._trigger("always",null,s)},_onSend:function(e,i){i.submit||this._addConvenienceMethods(e,i);var s,o,n,r,a=this,l=a._getAJAXSettings(i),h=function(){return a._sending+=1,l._bitrateTimer=new a._BitrateTimer,s=s||((o||a._trigger("send",t.Event("send",{delegatedEvent:e}),l)===!1)&&a._getXHRPromise(!1,l.context,o)||a._chunkedUpload(l)||t.ajax(l)).done(function(t,e,i){a._onDone(t,e,i,l)}).fail(function(t,e,i){a._onFail(t,e,i,l)}).always(function(t,e,i){if(a._onAlways(t,e,i,l),a._sending-=1,a._active-=1,l.limitConcurrentUploads&&l.limitConcurrentUploads>a._sending)for(var s=a._slots.shift();s;){if("pending"===a._getDeferredState(s)){s.resolve();break}s=a._slots.shift()}0===a._active&&a._trigger("stop")})};return this._beforeSend(e,l),this.options.sequentialUploads||this.options.limitConcurrentUploads&&this.options.limitConcurrentUploads<=this._sending?(this.options.limitConcurrentUploads>1?(n=t.Deferred(),this._slots.push(n),r=n.pipe(h)):(this._sequence=this._sequence.pipe(h,h),r=this._sequence),r.abort=function(){return o=[void 0,"abort","abort"],s?s.abort():(n&&n.rejectWith(l.context,o),h())},this._enhancePromise(r)):h()},_onAdd:function(e,i){var s,o,n,r,a=this,l=!0,h=t.extend({},this.options,i),c=i.files,p=c.length,u=h.limitMultiFileUploads,d=h.limitMultiFileUploadSize,f=h.limitMultiFileUploadSizeOverhead,g=0,m=this._getParamName(h),_=0;if(!d||p&&void 0!==c[0].size||(d=void 0),(h.singleFileUploads||u||d)&&this._isXHRUpload(h))if(h.singleFileUploads||d||!u)if(!h.singleFileUploads&&d)for(n=[],s=[],r=0;p>r;r+=1)g+=c[r].size+f,(r+1===p||g+c[r+1].size+f>d||u&&r+1-_>=u)&&(n.push(c.slice(_,r+1)),o=m.slice(_,r+1),o.length||(o=m),s.push(o),_=r+1,g=0);else s=m;else for(n=[],s=[],r=0;p>r;r+=u)n.push(c.slice(r,r+u)),o=m.slice(r,r+u),o.length||(o=m),s.push(o);else n=[c],s=[m];return i.originalFiles=c,t.each(n||c,function(o,r){var h=t.extend({},i);return h.files=n?r:[r],h.paramName=s[o],a._initResponseObject(h),a._initProgressObject(h),a._addConvenienceMethods(e,h),l=a._trigger("add",t.Event("add",{delegatedEvent:e}),h)}),l},_replaceFileInput:function(e){var i=e.clone(!0);t("<form></form>").append(i)[0].reset(),e.after(i).detach(),t.cleanData(e.unbind("remove")),this.options.fileInput=this.options.fileInput.map(function(t,s){return s===e[0]?i[0]:s}),e[0]===this.element[0]&&(this.element=i)},_handleFileTreeEntry:function(e,i){var s,o=this,n=t.Deferred(),r=function(t){t&&!t.entry&&(t.entry=e),n.resolve([t])};return i=i||"",e.isFile?e._file?(e._file.relativePath=i,n.resolve(e._file)):e.file(function(t){t.relativePath=i,n.resolve(t)},r):e.isDirectory?(s=e.createReader(),s.readEntries(function(t){o._handleFileTreeEntries(t,i+e.name+"/").done(function(t){n.resolve(t)}).fail(r)},r)):n.resolve([]),n.promise()},_handleFileTreeEntries:function(e,i){var s=this;return t.when.apply(t,t.map(e,function(t){return s._handleFileTreeEntry(t,i)})).pipe(function(){return Array.prototype.concat.apply([],arguments)})},_getDroppedFiles:function(e){e=e||{};var i=e.items;return i&&i.length&&(i[0].webkitGetAsEntry||i[0].getAsEntry)?this._handleFileTreeEntries(t.map(i,function(t){var e;return t.webkitGetAsEntry?(e=t.webkitGetAsEntry(),e&&(e._file=t.getAsFile()),e):t.getAsEntry()})):t.Deferred().resolve(t.makeArray(e.files)).promise()},_getSingleFileInputFiles:function(e){e=t(e);var i,s,o=e.prop("webkitEntries")||e.prop("entries");if(o&&o.length)return this._handleFileTreeEntries(o);if(i=t.makeArray(e.prop("files")),i.length)void 0===i[0].name&&i[0].fileName&&t.each(i,function(t,e){e.name=e.fileName,e.size=e.fileSize});else{if(s=e.prop("value"),!s)return t.Deferred().resolve([]).promise();i=[{name:s.replace(/^.*\\/,"")}]}return t.Deferred().resolve(i).promise()},_getFileInputFiles:function(e){return e instanceof t&&1!==e.length?t.when.apply(t,t.map(e,this._getSingleFileInputFiles)).pipe(function(){return Array.prototype.concat.apply([],arguments)
}):this._getSingleFileInputFiles(e)},_onChange:function(e){var i=this,s={fileInput:t(e.target),form:t(e.target.form)};this._getFileInputFiles(s.fileInput).always(function(o){s.files=o,i.options.replaceFileInput&&i._replaceFileInput(s.fileInput),i._trigger("change",t.Event("change",{delegatedEvent:e}),s)!==!1&&i._onAdd(e,s)})},_onPaste:function(e){var i=e.originalEvent&&e.originalEvent.clipboardData&&e.originalEvent.clipboardData.items,s={files:[]};i&&i.length&&(t.each(i,function(t,e){var i=e.getAsFile&&e.getAsFile();i&&s.files.push(i)}),this._trigger("paste",t.Event("paste",{delegatedEvent:e}),s)!==!1&&this._onAdd(e,s))},_onDrop:function(e){e.dataTransfer=e.originalEvent&&e.originalEvent.dataTransfer;var i=this,s=e.dataTransfer,o={};s&&s.files&&s.files.length&&(e.preventDefault(),this._getDroppedFiles(s).always(function(s){o.files=s,i._trigger("drop",t.Event("drop",{delegatedEvent:e}),o)!==!1&&i._onAdd(e,o)}))},_onDragOver:function(e){e.dataTransfer=e.originalEvent&&e.originalEvent.dataTransfer;var i=e.dataTransfer;i&&-1!==t.inArray("Files",i.types)&&this._trigger("dragover",t.Event("dragover",{delegatedEvent:e}))!==!1&&(e.preventDefault(),i.dropEffect="copy")},_initEventHandlers:function(){this._isXHRUpload(this.options)&&(this._on(this.options.dropZone,{dragover:this._onDragOver,drop:this._onDrop}),this._on(this.options.pasteZone,{paste:this._onPaste})),t.support.fileInput&&this._on(this.options.fileInput,{change:this._onChange})},_destroyEventHandlers:function(){this._off(this.options.dropZone,"dragover drop"),this._off(this.options.pasteZone,"paste"),this._off(this.options.fileInput,"change")},_setOption:function(e,i){var s=-1!==t.inArray(e,this._specialOptions);s&&this._destroyEventHandlers(),this._super(e,i),s&&(this._initSpecialOptions(),this._initEventHandlers())},_initSpecialOptions:function(){var e=this.options;void 0===e.fileInput?e.fileInput=this.element.is('input[type="file"]')?this.element:this.element.find('input[type="file"]'):e.fileInput instanceof t||(e.fileInput=t(e.fileInput)),e.dropZone instanceof t||(e.dropZone=t(e.dropZone)),e.pasteZone instanceof t||(e.pasteZone=t(e.pasteZone))},_getRegExp:function(t){var e=t.split("/"),i=e.pop();return e.shift(),RegExp(e.join("/"),i)},_isRegExpOption:function(e,i){return"url"!==e&&"string"===t.type(i)&&/^\/.*\/[igm]{0,3}$/.test(i)},_initDataAttributes:function(){var e=this,i=this.options;t.each(t(this.element[0].cloneNode(!1)).data(),function(t,s){e._isRegExpOption(t,s)&&(s=e._getRegExp(s)),i[t]=s})},_create:function(){this._initDataAttributes(),this._initSpecialOptions(),this._slots=[],this._sequence=this._getXHRPromise(!0),this._sending=this._active=0,this._initProgressObject(this),this._initEventHandlers()},active:function(){return this._active},progress:function(){return this._progress},add:function(e){var i=this;e&&!this.options.disabled&&(e.fileInput&&!e.files?this._getFileInputFiles(e.fileInput).always(function(t){e.files=t,i._onAdd(null,e)}):(e.files=t.makeArray(e.files),this._onAdd(null,e)))},send:function(e){if(e&&!this.options.disabled){if(e.fileInput&&!e.files){var i,s,o=this,n=t.Deferred(),r=n.promise();return r.abort=function(){return s=!0,i?i.abort():(n.reject(null,"abort","abort"),r)},this._getFileInputFiles(e.fileInput).always(function(t){if(!s){if(!t.length)return n.reject(),void 0;e.files=t,i=o._onSend(null,e).then(function(t,e,i){n.resolve(t,e,i)},function(t,e,i){n.reject(t,e,i)})}}),this._enhancePromise(r)}if(e.files=t.makeArray(e.files),e.files.length)return this._onSend(null,e)}return this._getXHRPromise(!1,e&&e.context)}})});